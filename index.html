<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng qu·∫£n l√Ω Comment CTV TikTok</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const CommentManager = () => {
            const [selectedCTV, setSelectedCTV] = useState(null);
            const [expandedSections, setExpandedSections] = useState({});
            const [completedComments, setCompletedComments] = useState({});
            const [comments, setComments] = useState({});

            // Load data t·ª´ localStorage khi component mount
            useEffect(() => {
                try {
                    const savedCompleted = JSON.parse(window.localStorage?.getItem('ctvCompletedComments') || '{}');
                    const savedComments = JSON.parse(window.localStorage?.getItem('ctvComments') || '{}');
                    setCompletedComments(savedCompleted);
                    setComments(savedComments);
                } catch (error) {
                    console.log('Kh√¥ng th·ªÉ load d·ªØ li·ªáu t·ª´ localStorage');
                }
            }, []);

            // Save data v√†o localStorage khi c√≥ thay ƒë·ªïi
            useEffect(() => {
                try {
                    window.localStorage?.setItem('ctvCompletedComments', JSON.stringify(completedComments));
                } catch (error) {
                    console.log('Kh√¥ng th·ªÉ l∆∞u completed comments');
                }
            }, [completedComments]);

            useEffect(() => {
                try {
                    window.localStorage?.setItem('ctvComments', JSON.stringify(comments));
                } catch (error) {
                    console.log('Kh√¥ng th·ªÉ l∆∞u comments');
                }
            }, [comments]);

            const ctvData = [
                { id: 1, name: "B·∫£o Hu√¢n", nicks: ["Tr·ªçng ho√†ng", "Baby kajima", "Hachthieuhoang"] },
                { id: 2, name: "Huy Ho√†ng", nicks: ["Truongnhuocnam", "Dangthaouyen", "Lyvantieu"] },
                { id: 3, name: "Trung Ki√™n", nicks: ["Huynh Thanh Hoang", "C·∫≠u ƒë√†o b·∫£nh", "Thanh Huy"] },
                { id: 4, name: "Vi·ªát Nguy·ªÖn", nicks: ["ƒê·ª©c tr·ªçng qu·∫≠n 9", "Siuponaruto", "V≈© Di·ªáp Chi", "T√¥ Huy·ªÅn My"] },
                { id: 5, name: "Xu√¢n An", nicks: ["tinhuy2k2", "daicaduongqua4", "anhypp5"] },
                { id: 6, name: "Qanh", nicks: ["Thanh h·∫±ng", "Thua vua tr√≤ ch∆°i m·ªói c√°i t√™n", "Thy an H·ªì"] },
                { id: 7, name: "QA", nicks: ["Louis Nguy·ªÖn", "Mai s∆°n", "H√†o M√£"] },
                { id: 8, name: "Ki√™n S·∫øu", nicks: ["T·ªëng Quang Linh", "Xa l√† nh·ªõ", "B√¨nh th∆∞·ªùng th√¥i"] },
                { id: 9, name: "Hu·ª≥nh ƒê·ª©c", nicks: ["T√≠n v√µ", "Vinh l√™", "Huy h·ªì"] },
                { id: 10, name: "Nobita", nicks: ["Sang s·∫•m sex‚ö°Ô∏è‚ö°Ô∏è‚ö°Ô∏è", "Ho√†ng Long", "Tienkhoilatao"] },
                { id: 11, name: "Qu·ªëc B·∫£o", nicks: ["Dung lam", "Ng·ªçc v≈©", "Uy√™n tr·∫ßn"] },
                { id: 12, name: "NHV", nicks: ["BƒÉng BƒÉng", "Mai Th·∫£o My", "Mie"] },
                { id: 13, name: "Luy·∫øn", nicks: ["Ph∆∞∆°ng Tu·∫•n", "C√≤n th·ªü c√≤n g·ª°", "Trang Nemo", "Tr·∫ßn VƒÉn Bo"] },
                { id: 14, name: "Ch√≠ B·∫£o", nicks: ["gaumap2024", "bb090702", "baobaoipuuuuu", "baobao472"] },
                { id: 15, name: "B·∫£o Phan", nicks: ["trumfcc", "baobaonpcb", "vuonhoaconca97", "pduyenn610"] }
            ];

            const getCommenters = (targetCtvId) => {
                const commenters = [];
                for (let i = 1; i <= 15; i++) {
                    let startId = i + 1;
                    let endId = i + 10;
                    
                    const targetIds = [];
                    for (let j = startId; j <= endId; j++) {
                        let actualId = j;
                        if (j > 15) actualId = j - 15;
                        targetIds.push(actualId);
                    }
                    
                    if (targetIds.includes(targetCtvId)) {
                        commenters.push(i);
                    }
                }
                return commenters;
            };

            const getTargets = (ctvId) => {
                const targets = [];
                let startId = ctvId + 1;
                let endId = ctvId + 10;
                
                for (let i = startId; i <= endId; i++) {
                    let actualId = i;
                    if (i > 15) actualId = i - 15;
                    targets.push(actualId);
                }
                return targets;
            };

            const toggleSection = (section) => {
                setExpandedSections(prev => ({
                    ...prev,
                    [section]: !prev[section]
                }));
            };

            const handleCheckboxChange = (commenterId, targetId, videoIndex) => {
                const key = `${commenterId}-${targetId}-${videoIndex}`;
                setCompletedComments(prev => ({
                    ...prev,
                    [key]: !prev[key]
                }));
            };

            const handleCommentChange = (commenterId, targetId, videoIndex, value) => {
                const key = `${commenterId}-${targetId}-${videoIndex}`;
                setComments(prev => ({
                    ...prev,
                    [key]: value
                }));
            };

            const exportData = () => {
                const exportData = [];
                const targetCtv = ctvData.find(c => c.id === selectedCTV);
                
                getCommenters(selectedCTV).forEach(commenterId => {
                    const commenterCtv = ctvData.find(c => c.id === commenterId);
                    
                    commenterCtv?.nicks.slice(0, 3).forEach((nick, videoIndex) => {
                        const key = `${commenterId}-${selectedCTV}-${videoIndex}`;
                        const isCompleted = completedComments[key];
                        
                        if (!isCompleted) {
                            exportData.push({
                                'CTV Comment': commenterCtv.name,
                                'Nick Comment': nick,
                                'Video': `Video ${videoIndex + 1}`,
                                'CTV ƒê∆∞·ª£c Comment': targetCtv?.name,
                                'Nick ƒê∆∞·ª£c Comment': targetCtv?.nicks[videoIndex] || '',
                                'Ghi Ch√∫': comments[key] || ''
                            });
                        }
                    });
                });

                // T·∫°o CSV content
                const csvContent = exportData.map(row => 
                    Object.values(row).map(val => `"${(val || '').toString().replace(/"/g, '""')}"`).join(',')
                ).join('\n');
                
                const headers = Object.keys(exportData[0] || {}).map(h => `"${h}"`).join(',');
                const fullCsvContent = headers + '\n' + csvContent;

                // T·∫°o file download
                const blob = new Blob(['\ufeff' + fullCsvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `CTV_${targetCtv?.name}_Comments_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const totalCommentsPerVideo = 10;
            const totalCommentsPerCTV = totalCommentsPerVideo * 3;

            const getCompletedCount = (targetCtvId) => {
                let completed = 0;
                getCommenters(targetCtvId).forEach(commenterId => {
                    for (let i = 0; i < 3; i++) {
                        const key = `${commenterId}-${targetCtvId}-${i}`;
                        if (completedComments[key]) completed++;
                    }
                });
                return completed;
            };

            return React.createElement('div', { className: "max-w-7xl mx-auto p-6 bg-gray-50 min-h-screen" },
                React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
                    React.createElement('h1', { className: "text-2xl font-bold text-gray-800 mb-4 flex items-center" },
                        React.createElement('span', { className: "mr-2" }, 'üí¨'),
                        'H·ªá th·ªëng qu·∫£n l√Ω Comment CTV TikTok'
                    ),
                    
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" },
                        React.createElement('div', { className: "bg-blue-50 p-4 rounded-lg" },
                            React.createElement('div', { className: "flex items-center text-blue-600 mb-2" },
                                React.createElement('span', { className: "mr-2" }, 'üë•'),
                                React.createElement('span', { className: "font-semibold" }, 'T·ªïng CTV')
                            ),
                            React.createElement('div', { className: "text-2xl font-bold text-blue-800" }, '15')
                        ),
                        
                        React.createElement('div', { className: "bg-green-50 p-4 rounded-lg" },
                            React.createElement('div', { className: "flex items-center text-green-600 mb-2" },
                                React.createElement('span', { className: "mr-2" }, 'üìπ'),
                                React.createElement('span', { className: "font-semibold" }, 'Comment/Video')
                            ),
                            React.createElement('div', { className: "text-2xl font-bold text-green-800" }, '10')
                        ),
                        
                        React.createElement('div', { className: "bg-purple-50 p-4 rounded-lg" },
                            React.createElement('div', { className: "flex items-center text-purple-600 mb-2" },
                                React.createElement('span', { className: "mr-2" }, 'üí¨'),
                                React.createElement('span', { className: "font-semibold" }, 'Comment/CTV')
                            ),
                            React.createElement('div', { className: "text-2xl font-bold text-purple-800" }, '30')
                        )
                    )
                ),

                React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-6" },
                    // Danh s√°ch CTV
                    React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6" },
                        React.createElement('div', { 
                            className: "flex items-center justify-between cursor-pointer mb-4",
                            onClick: () => toggleSection('ctvList')
                        },
                            React.createElement('h2', { className: "text-xl font-semibold text-gray-800" }, 'Danh s√°ch CTV'),
                            React.createElement('span', null, expandedSections.ctvList ? '‚ñº' : '‚ñ∂')
                        ),
                        
                        (expandedSections.ctvList !== false) && React.createElement('div', { className: "space-y-2" },
                            ctvData.map((ctv) => {
                                const completedCount = getCompletedCount(ctv.id);
                                const totalCount = getCommenters(ctv.id).length * 3;
                                const completionPercentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
                                
                                return React.createElement('div', {
                                    key: ctv.id,
                                    className: `p-3 rounded-lg cursor-pointer transition-all ${
                                        selectedCTV === ctv.id 
                                            ? 'bg-blue-100 border-2 border-blue-300' 
                                            : 'bg-gray-50 hover:bg-gray-100'
                                    }`,
                                    onClick: () => setSelectedCTV(selectedCTV === ctv.id ? null : ctv.id)
                                },
                                    React.createElement('div', { className: "flex items-center justify-between" },
                                        React.createElement('div', null,
                                            React.createElement('span', { className: "font-medium text-gray-800" },
                                                `${ctv.id}. ${ctv.name}`
                                            ),
                                            React.createElement('span', { className: "text-sm text-gray-500 ml-2" },
                                                `(${ctv.nicks.length} nick${ctv.nicks.length > 1 ? 's' : ''})`
                                            )
                                        ),
                                        React.createElement('div', { className: "flex items-center space-x-2" },
                                            React.createElement('span', { 
                                                className: `text-xs px-2 py-1 rounded ${
                                                    completionPercentage === 100 ? 'bg-green-100 text-green-800' :
                                                    completionPercentage > 0 ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-gray-100 text-gray-600'
                                                }`
                                            }, `${completionPercentage}%`),
                                            React.createElement('span', { className: "text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded" },
                                                `${totalCommentsPerCTV} cmt`
                                            )
                                        )
                                    ),
                                    
                                    selectedCTV === ctv.id && React.createElement('div', { className: "mt-3 pt-3 border-t border-gray-200" },
                                        React.createElement('div', { className: "text-sm text-gray-600 mb-2" }, 'Danh s√°ch nick:'),
                                        React.createElement('div', { className: "flex flex-wrap gap-1" },
                                            ctv.nicks.slice(0, 3).map((nick, index) =>
                                                React.createElement('span', {
                                                    key: index,
                                                    className: "text-xs bg-green-100 text-green-800 px-2 py-1 rounded"
                                                }, `Video ${index + 1}: ${nick}`)
                                            )
                                        ),
                                        ctv.nicks.length > 3 && React.createElement('div', { className: "mt-1" },
                                            React.createElement('span', { className: "text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded" },
                                                `Nick d·ª± ph√≤ng: ${ctv.nicks.slice(3).join(', ')}`
                                            )
                                        )
                                    )
                                );
                            })
                        )
                    ),

                    // Chi ti·∫øt CTV ƒë∆∞·ª£c ch·ªçn
                    selectedCTV && React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6" },
                        React.createElement('div', { className: "flex items-center justify-between mb-4" },
                            React.createElement('h2', { className: "text-xl font-semibold text-gray-800" },
                                `Chi ti·∫øt: ${ctvData.find(c => c.id === selectedCTV)?.name}`
                            ),
                            React.createElement('button', {
                                onClick: exportData,
                                className: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center space-x-2 transition-colors"
                            },
                                React.createElement('span', null, 'üìä'),
                                React.createElement('span', null, 'Xu·∫•t Excel')
                            )
                        ),
                        
                        React.createElement('div', { className: "space-y-4" },
                            // Ai s·∫Ω comment CTV n√†y (v·ªõi checkbox v√† comment)
                            React.createElement('div', { className: "bg-green-50 p-4 rounded-lg" },
                                React.createElement('h3', { className: "font-medium text-green-800 mb-3" },
                                    'üí¨ CTV n√†y s·∫Ω ƒë∆∞·ª£c comment b·ªüi:'
                                ),
                                React.createElement('div', { className: "space-y-3" },
                                    getCommenters(selectedCTV).map(commenterId => {
                                        const commenterCtv = ctvData.find(c => c.id === commenterId);
                                        const targetCtv = ctvData.find(c => c.id === selectedCTV);
                                        
                                        return React.createElement('div', {
                                            key: commenterId,
                                            className: "bg-green-100 p-4 rounded-lg"
                                        },
                                            React.createElement('div', { className: "text-sm font-medium text-green-800 mb-3" },
                                                `${commenterId}. ${commenterCtv?.name}`
                                            ),
                                            
                                            React.createElement('div', { className: "space-y-3" },
                                                commenterCtv?.nicks.slice(0, 3).map((nick, videoIndex) => {
                                                    const key = `${commenterId}-${selectedCTV}-${videoIndex}`;
                                                    const isCompleted = completedComments[key] || false;
                                                    const commentText = comments[key] || '';
                                                    
                                                    return React.createElement('div', {
                                                        key: videoIndex,
                                                        className: `bg-white p-3 rounded border ${isCompleted ? 'bg-gray-50 opacity-75' : ''}`
                                                    },
                                                        React.createElement('div', { className: "flex items-center space-x-3 mb-2" },
                                                            React.createElement('input', {
                                                                type: 'checkbox',
                                                                id: `checkbox-${key}`,
                                                                checked: isCompleted,
                                                                onChange: () => handleCheckboxChange(commenterId, selectedCTV, videoIndex),
                                                                className: "w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 focus:ring-2"
                                                            }),
                                                            React.createElement('label', {
                                                                htmlFor: `checkbox-${key}`,
                                                                className: `text-sm font-medium cursor-pointer ${isCompleted ? 'text-gray-500 line-through' : 'text-gray-700'}`
                                                            }, `Video ${videoIndex + 1}: ${nick} ‚Üí ${targetCtv?.nicks[videoIndex] || ''}`)
                                                        ),
                                                        
                                                        React.createElement('textarea', {
                                                            placeholder: 'Ghi ch√∫ comment...',
                                                            value: commentText,
                                                            onChange: (e) => handleCommentChange(commenterId, selectedCTV, videoIndex, e.target.value),
                                                            disabled: isCompleted,
                                                            className: `w-full p-2 text-xs border border-gray-300 rounded-md resize-none ${
                                                                isCompleted ? 'bg-gray-100 text-gray-500' : 'focus:ring-2 focus:ring-green-500 focus:border-transparent'
                                                            }`,
                                                            rows: 2
                                                        })
                                                    );
                                                })
                                            )
                                        );
                                    })
                                ),

                                // CTV n√†y s·∫Ω comment ai
                                React.createElement('div', { className: "bg-yellow-50 p-4 rounded-lg" },
                                    React.createElement('h3', { className: "font-medium text-yellow-800 mb-2" },
                                        'üéØ CTV n√†y s·∫Ω comment cho:'
                                    ),
                                    React.createElement('div', { className: "space-y-2" },
                                        getTargets(selectedCTV).map(targetId => {
                                            const targetCtv = ctvData.find(c => c.id === targetId);
                                            return React.createElement('div', {
                                                key: targetId,
                                                className: "bg-yellow-100 p-3 rounded"
                                            },
                                                React.createElement('div', { className: "text-sm font-medium text-yellow-800" },
                                                    `${targetId}. ${targetCtv?.name}`
                                                ),
                                                React.createElement('div', { className: "mt-2 text-xs text-yellow-700" },
                                                    React.createElement('strong', null, 'Video v√† nick t∆∞∆°ng ·ª©ng:')
                                                ),
                                                React.createElement('div', { className: "grid grid-cols-1 gap-1 mt-1" },
                                                    targetCtv?.nicks.slice(0, 3).map((nick, index) =>
                                                        React.createElement('div', {
                                                            key: index,
                                                            className: "text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded"
                                                        }, `Video ${index + 1}: `, React.createElement('strong', null, nick))
                                                    )
                                                )
                                            );
                                        })
                                    ),
                                    React.createElement('div', { className: "mt-3 text-sm text-yellow-700 bg-yellow-100 p-2 rounded" },
                                        React.createElement('strong', null, 'T·ªïng k·∫øt: '),
                                        `${getTargets(selectedCTV).length} CTV √ó 3 video = ${getTargets(selectedCTV).length * 3} comment c·∫ßn th·ª±c hi·ªán`
                                    )
                                ),

                                React.createElement('div', { className: "mt-3 text-sm text-green-700 bg-green-100 p-2 rounded" },
                                    React.createElement('strong', null, 'T·ªïng k·∫øt: '),
                                    `M·ªói video s·∫Ω c√≥ ${getCommenters(selectedCTV).length} comment t·ª´ ${getCommenters(selectedCTV).length} CTV kh√°c nhau`
                                )
                            ),

                            // Th·ªëng k√™ video
                            React.createElement('div', { className: "bg-blue-50 p-4 rounded-lg" },
                                React.createElement('h3', { className: "font-medium text-blue-800 mb-2" },
                                    'üìä Th·ªëng k√™ video:'
                                ),
                                React.createElement('div', { className: "space-y-2 text-sm" },
                                    React.createElement('div', null, '‚Ä¢ 3 video t∆∞∆°ng ·ª©ng v·ªõi 3 nick ƒë·∫ßu ti√™n'),
                                    React.createElement('div', null, `‚Ä¢ M·ªói video nh·∫≠n ${totalCommentsPerVideo} comment`),
                                    React.createElement('div', null, `‚Ä¢ T·ªïng comment nh·∫≠n ƒë∆∞·ª£c: ${totalCommentsPerVideo * 3} comment`),
                                    React.createElement('div', null, `‚Ä¢ T·ªïng comment ph·∫£i th·ª±c hi·ªán: ${totalCommentsPerCTV} comment`),
                                    React.createElement('div', { className: "font-medium text-blue-700" }, 
                                        `‚Ä¢ Ho√†n th√†nh: ${getCompletedCount(selectedCTV)}/${getCommenters(selectedCTV).length * 3} comment`
                                    )
                                )
                            )
                        )
                    ),

                    // T·ªïng quan h·ªá th·ªëng
                    !selectedCTV && React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6" },
                        React.createElement('h2', { className: "text-xl font-semibold text-gray-800 mb-4" },
                            'üìà T·ªïng quan h·ªá th·ªëng'
                        ),
                        
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', { className: "bg-gray-50 p-4 rounded-lg" },
                                React.createElement('h3', { className: "font-medium text-gray-800 mb-2" }, 'Quy t·∫Øc comment:'),
                                React.createElement('ul', { className: "text-sm text-gray-600 space-y-1" },
                                    React.createElement('li', null, '‚Ä¢ CTV th·ª© N comment cho 10 CTV ti·∫øp theo (N+1 ƒë·∫øn N+10)'),
                                    React.createElement('li', null, '‚Ä¢ M·ªói CTV c√≥ 3 video (t∆∞∆°ng ·ª©ng 3 nick ƒë·∫ßu)'),
                                    React.createElement('li', null, '‚Ä¢ M·ªói CTV ph·∫£i th·ª±c hi·ªán 30 comment (10 CTV √ó 3 video)'),
                                    React.createElement('li', null, '‚Ä¢ M·ªói video s·∫Ω nh·∫≠n ƒë∆∞·ª£c 10 comment t·ª´ 10 CTV kh√°c nhau')
                                )
                            ),
                            
                            React.createElement('div', { className: "bg-indigo-50 p-4 rounded-lg" },
                                React.createElement('h3', { className: "font-medium text-indigo-800 mb-2" }, 'Th·ªëng k√™ t·ªïng:'),
                                React.createElement('div', { className: "grid grid-cols-2 gap-4 text-sm" },
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "text-indigo-600" }, 'T·ªïng video:'),
                                        React.createElement('div', { className: "font-bold text-indigo-800" }, '45 video'),
                                        React.createElement('div', { className: "text-xs text-indigo-500" }, '(15 CTV √ó 3 video)')
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "text-indigo-600" }, 'T·ªïng comment:'),
                                        React.createElement('div', { className: "font-bold text-indigo-800" }, '450 comment'),
                                        React.createElement('div', { className: "text-xs text-indigo-500" }, '(45 video √ó 10 cmt)')
                                    )
                                )
                            ),

                            React.createElement('div', { className: "bg-orange-50 p-4 rounded-lg" },
                                React.createElement('p', { className: "text-sm text-orange-800" },
                                    'üí° ',
                                    React.createElement('strong', null, 'M·∫πo:'),
                                    ' Nh·∫•p v√†o b·∫•t k·ª≥ CTV n√†o ·ªü b√™n tr√°i ƒë·ªÉ xem chi ti·∫øt. ƒê√°nh d·∫•u checkbox khi ho√†n th√†nh comment v√† th√™m ghi ch√∫ n·∫øu c·∫ßn. B·∫•m "Xu·∫•t Excel" ƒë·ªÉ xu·∫•t danh s√°ch c√°c comment ch∆∞a ho√†n th√†nh!'
                                )
                            )
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(CommentManager));
    </script>
</body>
</html>
